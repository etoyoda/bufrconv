# BUFRとは
BUFR とは、WMO（世界気象機関）がGTS（全球気象通信網）での国際データ交換に用いるために開発したデータ形式（通報式）のひとつです。
現在 WMO は通報式を GRIB と BUFR に集約する方針ですが、
格子データに特化したGRIBになじまないような時空間構造を持つデータ、
強いて今風に言うならば半構造データを表現するために、BUFR は用いられます。

BUFR は Binary Universal Form for the Representation of meteorological data
の略で、データ構造を問わないという意図を表現した名前です。

以下、一般的な解説に交えて本 bufrconv パッケージの説明をしているところには
米印（※）を付します。

## BUFR の節構造

|節|長さ/オクテット|必須|説明|
|--|----------|----|----|
|0 |8         |必須|マジックナンバー "BUFR"、電文長、版番号|
|1 |17以上(3版), 22以上(4版)|必須|識別節 identification section|
|2 |可変|**任意**|任意節 optional section （有無は次表参照）|
|3 |可変|必須|資料記述節 data description section (データ構造記述)|
|4 |可変|必須|資料節 data section (データ本体)|
|5 |4   |必須|マジックナンバー "7777" |

BUFR に従うデータ表現は **BUFR 報 (BUFR message)** と呼ばれます。
データサンプルなどでは単独の BUFR 報（"BUFR" から "7777" まで一組）を
独のファイルに保存することもありますが、たいていの実務においては
WMO バッチ FTP 形式などなんらかの形式 (気象庁内でもシステム毎に
異なる) のファイルに多数の BUFR 報が格納されます。

第0節の電文長と第1～4節の冒頭3オクテットは、ビッグエンディアンの整数値で
オクテット数を指示します。データファイルからマジックナンバー "BUFR" を
探索するだけでは他のテキストなどと偶然一致してしまうことが
あるかもしれませんが、第1節から順に節の長さを追って "7777" が見つかる
ならば、正当な BUFR 報の構造と言えるでしょう。

※ bufrscan.rb では特定のファイル形式を仮定せず、マジックナンバー
"BUFR" を探索して節構造を検証することで BUFR 報を漏れなく
探すようにしています。

## BUFR第1節の構造

|※略称|第3版|第4版|説明|
|---|---|---|---|
|―|0-2|0-2|節の長さ|
|:mastab|3|3|マスター表の版番号|
|:ctr|5|4-5|作成中枢番号|
|:subctr|4|6-7|作成副中枢番号（作成中枢で管理）|
|:upd|6|8|更新一連番号|
|―|7|9|MSBが立っていたら第2節が存在する|
|:cat|8|10|カテゴリ番号|
|:subcat||11|サブカテゴリ番号（国際管理）|
|:subcat|9||サブカテゴリ番号（作成中枢で管理）|
|| |12|サブカテゴリ番号（作成中枢で管理）|
|:masver|10|13|マスター表の版番号|
|:locver|11|14|ローカル表の版番号|
|:reftime||15-16|参照日時（年）|
|↑|12||参照日時（年の下2桁）|
|↑|13|17|参照日時（月）|
|↑|14|18|参照日時（日）|
|↑|15|19|参照日時（時）|
|↑|16|20|参照日時（分）|
|↑||21|参照日時（秒）|

※ bufrscan.rb 内の Bufrdcd#[] にこの略称を与えると解読結果が返ります。

BUFR 第1節はオクテット単位の構造をもち、
どんな通報にも共通のメタデータが入っています。
