# bufrdump.rb - BUFRデコーダライブラリ

BUFR をデコードしてテキストダンプ、JSON印字、
またはライブラリとして使えば
デコード結果のオブジェクトを yield で投げ返します。
内部で [bufrscan.rb](bufrscan.rb) を呼び出します。

# 単独での使用

> **ruby bufrdump.rb -x** _files ..._

記述子列の反復の範囲を判定し、集約を展開 (eXpand) した結果を
JSON 形式で印字する。

> **ruby bufrdump.rb -c** _files ..._

記述子列の反復の範囲を判定し、集約を展開し、
要素記述子の幅・単位・尺度・名称を調べ、操作記述子を適用して解読計画を
構成 (compile) した結果を
JSON 形式で印字する。

> **ruby bufrdump.rb -d** _files ..._

電文中の実データを毎行1要素の形式で印字 (dump) する。

各 BUFR 報は `bufrscan -d` と類似した概要表示（行頭は `{` である）から始まり、
サブセット毎に `=== subset ` から始まるサブセット番号表示に続いて
実データが印字される。
実データは数字6桁の記述子から始まる。
反復は `___ begin ` で始まる行から `^^^ end ` で始まる行までで、
反復毎に `--- next ` で始まる行が記載される。

> **ruby bufrdump.rb -j** _files ..._

電文中の実データをサブセット毎に JSON 形式で印字する。

各 BUFR 報は `bufrscan -d` と同じ概要表示（行頭は `{` である）から始まり、
サブセット毎に１行のJSON形式が印字される。
サブセット毎のJSONは配列の配列であり、
内側の配列は記述子文字列 （たとえば `"001001"`）と値の2要素からなるか、
反復の解読結果をあらわす。
反復の解読結果は、サブセットと同様の構造を持つ配列の配列である。
値は要素記述子の単位により文字列または数値となるが、
いずれにしても欠損の場合は `null` となる。
BUFR 報の終わりは `7777` だけの行で示される。


# デコード結果の構造

BUFR 電文の構造については [BUFR.md](BUFR.md) を参照してください。

まず簡単な場合から。
仮に集約がないBUFR報をデコードした場合、
結果は2要素の配列を要素とする配列となります。

記述子名を _FXXYYY_ のように間にスペースを入れないで文字列化したものがキーで、
値は String, Integer, Float, または nil です。

```json
[
  [ "001001", 47 ],
  [ "001002", 401 ],
  [ "001015", "WAKKANAI            " ],
  [ "002001", 1 ],
  [ "004001", 2019 ],
  [ "004002", 10 ],
  [ "004003", 27 ],
  [ "004004", 0 ],
  [ "004005", 0 ],
  [ "005001", 45.415000000000006 ],
  [ "006001", 141.67888000000002 ],
  //後略
```

